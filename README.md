## 场景
发起请求后，交由发送到消息队列处理，因为异步的关系，请求虽然可以返回ok，但是可能消息队列并没有处理完成。
此时如何确保返回的消息是准确的？
成功就是成功，失败就是失败，不能提示成功一刷新显示失败。

## 方案
两种大方向：1不多等，消息发出后直接接口返回；2.等，阻塞线程，等消息队列处理完成后返回。

- websocket，接口返回后持续显示请求中，直到消息队列消费完成发送ws消息回浏览器（也可以是定时器扫描结果发送ws消息）
- zookeeper watch机制，向消息队列发送消息前向Zookeeper注册一个node，watch后阻塞，等待消费者处理完成更新node触发watch事件。
  优点：可以借助临时节点机制，合理控制node数量不会存留脏数据；
  缺点：zookeeper一般服务中并不常用
- redis 订阅 ，基本与zookeeper类似，但是redis的使用频率更高
- 本demo，核心是自己维护了一个map，get时回阻塞线程，消息处理完成put的时候释放线程